INFO:     Will watch for changes in these directories: ['/home/saketh/Projects/dsa']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [66593] using WatchFiles
INFO:     Started server process [66596]
INFO:     Waiting for application startup.
INFO:src.main:Starting DSA Platform...
INFO:src.main:Database pool initialized
INFO:src.main:Dependencies initialized
INFO:src.workers.job_worker:Registered executor for job type: import
INFO:src.main:Job worker started
INFO:src.workers.job_worker:Starting job worker...
INFO:     Application startup complete.
INFO:     127.0.0.1:34520 - "GET /api/datasets/35/refs HTTP/1.1" 200 OK
ERROR:src.features.base_handler:Unexpected error in ListTablesHandler: 'str' object has no attribute 'keys'
Traceback (most recent call last):
  File "/home/saketh/Projects/dsa/src/features/base_handler.py", line 31, in wrapper
    return await func(self, *args, **kwargs)
  File "/home/saketh/Projects/dsa/src/features/versioning/get_table_data.py", line 126, in handle
    tables = await self._table_reader.list_table_keys(ref['commit_id'])
  File "/home/saketh/Projects/dsa/src/core/infrastructure/postgres/table_reader.py", line 27, in list_table_keys
    return list(schema_result.keys())
AttributeError: 'str' object has no attribute 'keys'
INFO:     127.0.0.1:51910 - "GET /api/datasets/35/refs/main/tables HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/saketh/.local/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/home/saketh/.local/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/home/saketh/.local/lib/python3.10/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
  File "/home/saketh/.local/lib/python3.10/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
  File "/home/saketh/Projects/dsa/src/api/versioning.py", line 111, in list_tables
    return await handler.handle(dataset_id, ref_name, current_user["id"])
  File "/home/saketh/Projects/dsa/src/features/base_handler.py", line 31, in wrapper
    return await func(self, *args, **kwargs)
  File "/home/saketh/Projects/dsa/src/features/versioning/get_table_data.py", line 126, in handle
    tables = await self._table_reader.list_table_keys(ref['commit_id'])
  File "/home/saketh/Projects/dsa/src/core/infrastructure/postgres/table_reader.py", line 27, in list_table_keys
    return list(schema_result.keys())
AttributeError: 'str' object has no attribute 'keys'
WARNING:  WatchFiles detected changes in 'src/core/infrastructure/postgres/table_reader.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:src.workers.job_worker:Stopping job worker...
INFO:src.main:Database pool closed
INFO:     Application shutdown complete.
INFO:     Finished server process [66596]
INFO:     Started server process [66717]
INFO:     Waiting for application startup.
INFO:src.main:Starting DSA Platform...
INFO:src.main:Database pool initialized
INFO:src.main:Dependencies initialized
INFO:src.workers.job_worker:Registered executor for job type: import
INFO:src.main:Job worker started
INFO:src.workers.job_worker:Starting job worker...
INFO:     Application startup complete.
INFO:     127.0.0.1:46988 - "GET /api/datasets/35/refs/main/tables HTTP/1.1" 200 OK
INFO:     127.0.0.1:59436 - "GET /api/datasets/35/refs/main/tables/test_data/data?limit=5 HTTP/1.1" 200 OK
INFO:     127.0.0.1:49522 - "GET /docs HTTP/1.1" 200 OK
INFO:     127.0.0.1:49522 - "GET /openapi.json HTTP/1.1" 200 OK
INFO:     127.0.0.1:53574 - "POST /api/datasets HTTP/1.1" 307 Temporary Redirect
INFO:     127.0.0.1:56912 - "POST /api/datasets/ HTTP/1.1" 401 Unauthorized
INFO:     127.0.0.1:52354 - "POST /api/users/login HTTP/1.1" 200 OK
INFO:     127.0.0.1:35306 - "POST /api/datasets/ HTTP/1.1" 200 OK
INFO:     127.0.0.1:45418 - "POST /api/datasets/36/refs/main/commits HTTP/1.1" 401 Unauthorized
INFO:     127.0.0.1:34248 - "POST /api/datasets/36/refs/main/commits HTTP/1.1" 200 OK
INFO:     127.0.0.1:34914 - "POST /api/datasets/36/refs/main/import HTTP/1.1" 200 OK
INFO:src.workers.job_worker:Processing job 9d748db9-5795-41f9-93e6-efc03b508f7d of type import
INFO:src.workers.job_worker:Job parameters type: <class 'str'>, value: {"filename": "multi_sheet_test.xlsx", "target_ref": "main", "commit_message": "Import multi-sheet Excel file", "temp_file_path": "/tmp/import_36_multi_sheet_test.xlsx"}
INFO:src.workers.import_executor:Import job 9d748db9-5795-41f9-93e6-efc03b508f7d - parameters type: <class 'str'>, value: {"filename": "multi_sheet_test.xlsx", "target_ref": "main", "commit_message": "Import multi-sheet Excel file", "temp_file_path": "/tmp/import_36_multi_sheet_test.xlsx"}
ERROR:src.workers.job_worker:Job 9d748db9-5795-41f9-93e6-efc03b508f7d failed: 'utf-8' codec can't decode bytes in position 10-11: invalid continuation byte
Traceback (most recent call last):
  File "/home/saketh/Projects/dsa/src/workers/job_worker.py", line 58, in process_job
    result = await executor.execute(job_id, parameters, self.db_pool)
  File "/home/saketh/Projects/dsa/src/workers/import_executor.py", line 52, in execute
    rows = await self._parse_file(temp_file_path, filename)
  File "/home/saketh/Projects/dsa/src/workers/import_executor.py", line 100, in _parse_file
    for idx, row_data in enumerate(reader):
  File "/usr/lib/python3.10/csv.py", line 110, in __next__
    self.fieldnames
  File "/usr/lib/python3.10/csv.py", line 97, in fieldnames
    self._fieldnames = next(self.reader)
  File "/usr/lib/python3.10/codecs.py", line 322, in decode
    (result, consumed) = self._buffer_decode(data, self.errors, final)
UnicodeDecodeError: 'utf-8' codec can't decode bytes in position 10-11: invalid continuation byte

INFO:     127.0.0.1:56738 - "GET /api/jobs/9d748db9-5795-41f9-93e6-efc03b508f7d HTTP/1.1" 200 OK
INFO:     127.0.0.1:42734 - "GET /api/datasets/36/refs/main/data?limit=10 HTTP/1.1" 200 OK
WARNING:src.features.base_handler:Validation error in GetCommitSchemaHandler: Schema not found for commit e26404d7c6a13b32a2305a00859070a1ff77b7820503f1ca32728ccaa357ea82
INFO:     127.0.0.1:53142 - "GET /api/datasets/36/commits/e26404d7c6a13b32a2305a00859070a1ff77b7820503f1ca32728ccaa357ea82/schema HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/saketh/.local/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/home/saketh/.local/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/saketh/.local/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/home/saketh/.local/lib/python3.10/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
  File "/home/saketh/.local/lib/python3.10/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
  File "/home/saketh/Projects/dsa/src/api/versioning.py", line 98, in get_commit_schema
    return await handler.handle(dataset_id, commit_id, current_user["id"])
  File "/home/saketh/Projects/dsa/src/features/base_handler.py", line 31, in wrapper
    return await func(self, *args, **kwargs)
  File "/home/saketh/Projects/dsa/src/features/versioning/get_commit_schema.py", line 41, in handle
    raise ValueError(f"Schema not found for commit {commit_id}")
ValueError: Schema not found for commit e26404d7c6a13b32a2305a00859070a1ff77b7820503f1ca32728ccaa357ea82
INFO:     127.0.0.1:32852 - "GET /api/datasets/36/refs/main/tables HTTP/1.1" 200 OK
INFO:     127.0.0.1:53558 - "GET /api/datasets/36/refs/main/tables/default/data?limit=10 HTTP/1.1" 200 OK
ERROR:src.features.base_handler:Unexpected error in GetTableSchemaHandler: 404: Table 'default' not found in this dataset
Traceback (most recent call last):
  File "/home/saketh/Projects/dsa/src/features/base_handler.py", line 31, in wrapper
    return await func(self, *args, **kwargs)
  File "/home/saketh/Projects/dsa/src/features/versioning/get_table_data.py", line 180, in handle
    raise HTTPException(
fastapi.exceptions.HTTPException: 404: Table 'default' not found in this dataset
INFO:     127.0.0.1:38488 - "GET /api/datasets/36/refs/main/tables/default/schema HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:34920 - "GET /api/datasets/36/history?limit=10 HTTP/1.1" 200 OK
INFO:     127.0.0.1:52440 - "GET /api/datasets/36/commits/e26404d7c6a13b32a2305a00859070a1ff77b7820503f1ca32728ccaa357ea82/data?limit=10 HTTP/1.1" 200 OK
INFO:     127.0.0.1:60644 - "GET /api/datasets/36/refs HTTP/1.1" 200 OK
INFO:     127.0.0.1:37152 - "POST /api/datasets/36/refs HTTP/1.1" 200 OK
INFO:     127.0.0.1:45282 - "DELETE /api/datasets/36/refs/excel-test-branch HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'src/workers/import_executor.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:src.workers.job_worker:Stopping job worker...
INFO:src.main:Database pool closed
INFO:     Application shutdown complete.
INFO:     Finished server process [66717]
INFO:     Started server process [67458]
INFO:     Waiting for application startup.
INFO:src.main:Starting DSA Platform...
INFO:src.main:Database pool initialized
INFO:src.main:Dependencies initialized
INFO:src.workers.job_worker:Registered executor for job type: import
INFO:src.main:Job worker started
INFO:src.workers.job_worker:Starting job worker...
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/workers/import_executor.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:src.workers.job_worker:Stopping job worker...
INFO:src.main:Database pool closed
INFO:     Application shutdown complete.
INFO:     Finished server process [67458]
INFO:     Started server process [67554]
INFO:     Waiting for application startup.
INFO:src.main:Starting DSA Platform...
INFO:src.main:Database pool initialized
INFO:src.main:Dependencies initialized
INFO:src.workers.job_worker:Registered executor for job type: import
INFO:src.main:Job worker started
INFO:src.workers.job_worker:Starting job worker...
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/features/versioning/create_commit.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:src.workers.job_worker:Stopping job worker...
INFO:src.main:Database pool closed
INFO:     Application shutdown complete.
INFO:     Finished server process [67554]
INFO:     Started server process [67626]
INFO:     Waiting for application startup.
INFO:src.main:Starting DSA Platform...
INFO:src.main:Database pool initialized
INFO:src.main:Dependencies initialized
INFO:src.workers.job_worker:Registered executor for job type: import
INFO:src.main:Job worker started
INFO:src.workers.job_worker:Starting job worker...
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/features/versioning/create_commit.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:src.workers.job_worker:Stopping job worker...
INFO:src.main:Database pool closed
INFO:     Application shutdown complete.
INFO:     Finished server process [67626]
INFO:     Started server process [67698]
INFO:     Waiting for application startup.
INFO:src.main:Starting DSA Platform...
INFO:src.main:Database pool initialized
INFO:src.main:Dependencies initialized
INFO:src.workers.job_worker:Registered executor for job type: import
INFO:src.main:Job worker started
INFO:src.workers.job_worker:Starting job worker...
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/features/versioning/create_commit.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:src.workers.job_worker:Stopping job worker...
INFO:src.main:Database pool closed
INFO:     Application shutdown complete.
INFO:     Finished server process [67698]
INFO:     Started server process [67765]
INFO:     Waiting for application startup.
INFO:src.main:Starting DSA Platform...
INFO:src.main:Database pool initialized
INFO:src.main:Dependencies initialized
INFO:src.workers.job_worker:Registered executor for job type: import
INFO:src.main:Job worker started
INFO:src.workers.job_worker:Starting job worker...
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/core/infrastructure/postgres/versioning_repo.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:src.workers.job_worker:Stopping job worker...
INFO:src.main:Database pool closed
INFO:     Application shutdown complete.
INFO:     Finished server process [67765]
INFO:     Started server process [67960]
INFO:     Waiting for application startup.
INFO:src.main:Starting DSA Platform...
INFO:src.main:Database pool initialized
INFO:src.main:Dependencies initialized
INFO:src.workers.job_worker:Registered executor for job type: import
INFO:src.main:Job worker started
INFO:src.workers.job_worker:Starting job worker...
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/features/versioning/create_commit.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:src.workers.job_worker:Stopping job worker...
INFO:src.main:Database pool closed
INFO:     Application shutdown complete.
INFO:     Finished server process [67960]
INFO:     Started server process [68034]
INFO:     Waiting for application startup.
INFO:src.main:Starting DSA Platform...
INFO:src.main:Database pool initialized
INFO:src.main:Dependencies initialized
INFO:src.workers.job_worker:Registered executor for job type: import
INFO:src.main:Job worker started
INFO:src.workers.job_worker:Starting job worker...
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/core/infrastructure/postgres/versioning_repo.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:src.workers.job_worker:Stopping job worker...
INFO:src.main:Database pool closed
INFO:     Application shutdown complete.
INFO:     Finished server process [68034]
INFO:     Started server process [68095]
INFO:     Waiting for application startup.
INFO:src.main:Starting DSA Platform...
INFO:src.main:Database pool initialized
INFO:src.main:Dependencies initialized
INFO:src.workers.job_worker:Registered executor for job type: import
INFO:src.main:Job worker started
INFO:src.workers.job_worker:Starting job worker...
INFO:     Application startup complete.
INFO:     127.0.0.1:36738 - "POST /api/datasets/36/refs/main/import HTTP/1.1" 200 OK
INFO:src.workers.job_worker:Processing job 10fe41a5-5f08-4b6d-bfd2-52e2e5c5c71b of type import
INFO:src.workers.job_worker:Job parameters type: <class 'str'>, value: {"filename": "multi_sheet_test.xlsx", "target_ref": "main", "commit_message": "Import multi-sheet Excel file - fixed", "temp_file_path": "/tmp/import_36_multi_sheet_test.xlsx"}
INFO:src.workers.import_executor:Import job 10fe41a5-5f08-4b6d-bfd2-52e2e5c5c71b - parameters type: <class 'str'>, value: {"filename": "multi_sheet_test.xlsx", "target_ref": "main", "commit_message": "Import multi-sheet Excel file - fixed", "temp_file_path": "/tmp/import_36_multi_sheet_test.xlsx"}
INFO:src.workers.job_worker:Job 10fe41a5-5f08-4b6d-bfd2-52e2e5c5c71b completed successfully
INFO:     127.0.0.1:34410 - "GET /api/jobs/10fe41a5-5f08-4b6d-bfd2-52e2e5c5c71b HTTP/1.1" 200 OK
INFO:     127.0.0.1:50920 - "GET /api/datasets/36/refs/main/tables HTTP/1.1" 200 OK
INFO:     127.0.0.1:34672 - "GET /api/datasets/36/commits/20250706044057_4aebfffa/schema HTTP/1.1" 200 OK
